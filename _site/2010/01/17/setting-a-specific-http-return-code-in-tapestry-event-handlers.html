<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Setting a specific HTTP return code in Tapestry event handlers</title>
	
	<link rel="canonical" href="http://0.0.0.0:4000/2010/01/17/setting-a-specific-http-return-code-in-tapestry-event-handlers.html"/>
	
	<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/css/schwab.css" type="text/css" />
	<link rel="stylesheet" href="/css/print.css" media="print" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed|Sansita:700|Zilla+Slab" rel="stylesheet">
	
	<link rel="alternate" type="application/rss+xml" title="Stephan Schwab" href="/rss.xml"/>

	<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
	<script type='text/javascript' src='/unitegallery/js/unitegallery.min.js'></script> 
		
	<link rel='stylesheet' href='/unitegallery/css/unite-gallery.css' type='text/css' /> 
	<script type='text/javascript' src='/unitegallery/themes/tiles/ug-theme-tiles.js'></script> 

	<meta property="og:title" content="Setting a specific HTTP return code in Tapestry event handlers">
	<meta property="twitter:title" content="Setting a specific HTTP return code in Tapestry event handlers">
	<meta property="og:description" content="">
	<meta property="twitter:description" content="">
	<meta property="og:type" content="article">
	<meta property="og:url" content="http://0.0.0.0:4000/2010/01/17/setting-a-specific-http-return-code-in-tapestry-event-handlers.html">
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:site" content="@snscaimito">
	
</head>


<body>
	<div class="container">
		<div class="header no-print">
  <div class="menu">
    <a href="/">Home</a>
    <a href="/category/software_development.html">Software</a>
    <a href="/category/farm-life.html">Farm Life</a>
    <a href="/category/Business.html">Business</a>
    <a href="/category/aviation.html">Aviation</a>
  </div>
  <div class="claim-box">
    <p class="claim">Tales about Aviation, Coaching, Farming, Software Development</p>
  </div>
</div>
		<div class="row">
			<div class="span9">
				<div class="post">
					<h1>Setting a specific HTTP return code in Tapestry event handlers</h1>
          <p>Java web frameworks help a lot in creating web applications. They abstract away a of the details of the HTTP protocol and if you use a component based framework, you get even more abstraction and pre-canned solutions for many tasks. As these frameworks are created to help in application development these employ a subset of HTTP features and sometimes do things that are contradictory or at least not very helpful to SEO (Search Engine Optimization) efforts. I’ve come across such a little detail and had to do some research to figure out how to solve the issue.</p>

<p>SEO is about creating HTML pages that are likely to appear high in the search results for many queries. SEO can be seen as some kind of black magic and in fact there appears to exist some kind of race or competition between search engine developers and SEO agencies. The people behind search engines try to figure out a way to show the most meaningful pages first in the result for query while SEO folks have a monetary interest in making sure that their client’s site gets listed first although it may not hold the most important or authoritative content for a given topic. Once you want to sell something that a lot of other people sell too, it is no longer about the content of your site. It is simply about exposure to more potential customers than others. That is why search engine ranking can have a significant impact on the bottom line.</p>

<p>Little details can make a huge different. One of those little details is how you do an HTTP redirect.</p>

<p>The HTTP protocol knows two status codes for redirects. One is 302 which means the page has been moved temporarily. The other is 301 which means the page has been moved permanently to a different location. You can see that the Web and thus the HTTP protocol was invented as a means to distribute documents. It wasn’t meant as a client-server protocol for applications. A URL defines the location of a document so that you can refer to it in a hyperlink or in another medium such as in an email. Now that we create interactive applications that resemble desktop applications we are stretching all this a bit and new challenges arise.</p>

<p>Search engines still think about the pages of an application as documents. They crawl everything they have access to and build an index of all the textual content. I guess they don’t care whether a page is an article about a product or is a product details page in some kind of product catalog with an order button.</p>

<p>Some search engines highly respect the difference between 302 (moved temporarily) and 301 (moved permanently). If you redirect from http://www.domain.com/app/mypage.html to http://www.domain.com/another/place/mypage.html with a 302 return code, the old URL will stay in their index. You might remove the old document and change other links so that after this is done only the new URL will be indexed. While both documents are available you may get punished for having duplicate content online. If you tell the search engine with a 301 return code (moved permanently) that the old URL won’t come back, it will delete the old URL from its index and no punishment for duplicate content can occur.</p>

<p>So that’s the background of why it is important to be able to set a specific HTTP return code. I had this issue during the development of a web application with the <a href="http://tapestry.apache.org">Tapestry</a> web framework and needed to find a clean solution that goes well along with the ideas of a component based framework. Although you can simply resort back to HTTP servlet programming in <a href="http://tapestry.apache.org">Tapestry</a> pages it is not really the best idea. It violates separation of concern because doing such stuff in a page class mixes application logic and HTTP protocol handling, may violate Don’t Repeat Yourself (you may need that in more places) and makes testing harder because suddently tests need to deal with all the servlet stuff as well.</p>

<p>After <a href="http://old.nabble.com/301-vs-302-redirects-due-to-SEO-ts27165953.html">a post on the <a href="http://tapestry.apache.org">Tapestry</a> mailing list</a> I got a very helpful reply by Lutz Hühnken who suggested to contribute to <a href="http://tapestry.apache.org">Tapestry</a>’s ComponentEventResultProcessor a new HttpStatusCode class. With that in place one can return an instance of HttpStatusCode from event handlers instead of just strings with the name of a page or a page class object.</p>

<p>Now a line like</p>

<p><code>return new HttpStatusCode(HttpServletResponse.SC_MOVED_PERMANENTLY, link) ;</code></p>

<p>solves the problem described above. This redirects the user agent to the URL link with a 301 return code instead of the usual 302 (moved temporarily).</p>

<p>Here is the snippet to contribute to the ComponentEventResultProcessor:</p>

<p>[sourcecode language=”java”]
public static void contributeComponentEventResultProcessor(
    MappedConfiguration&amp;lt;Class, ComponentEventResultProcessor&amp;gt; configuration, 
    final Response response) {
  configuration.add(HttpStatusCode.class, new ComponentEventResultProcessor() {
    public void processResultValue(HttpStatusCode value) throws IOException {
	  if (!value.getLocation().isEmpty())
	    response.setHeader("Location", value.getLocation());</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  response.sendError(value.getStatusCode(), &amp;quot;&amp;quot;);
}   }); } [/sourcecode]
</code></pre></div></div>

					<table class="postfooter" style="width: 100%">
					<tr>
						<td style="text-align: left; width: 33%"><a href="/2010/01/14/cherimoya-fruit-was-seeded.html">Previous</a></td>
						<td style="text-align: center; width: 33%">17 Jan 2010</td>
						<td style="text-align: right; width: 33%"><a href="/2010/01/26/hauling-a-tree-with-the-jeep.html">Next</a></td>
					</tr>
					</table>
					<p>This article has been posted to social media sites. There might be comments. Just follow the links:</p>
					<div>
						<a class="social-blogging" service="twitter" href="https://twitter.com/snscaimito"><img src="/img/Furry-Cushion-Twitter_48.png" /></a>
						<a class="social-blogging" service="activityPub" rel="me" href="https://techhub.social/@snscaimito"><img src="/img/mastodon.svg" width="48" /></a>
					</div>
				</div>
			</div>
			<div class="span3">
        <div class="sidebar">
        	<p class="section">About this article</p>
          <p>Published: January 17, 2010</p>
					<p>Posted in:
						
							<a class="categoryLink" href="/category/software_development.html">software_development</a>
						
					</p>
          
        </div>
				<div class="sidebar">
	<p class="section">About me</p>
	<p>Hello! My name is <a href="/">Stephan Schwab</a>.</p>
			<a href="/"><img src="http://www.gravatar.com/avatar/663d11426b0a187ddac59f8c17ce61b4?s=90" class="align-left"/></a>
		<p>As International Software Development Coach and Consultant I help CEOs and Department Leaders to <strong>improve</strong> <strong>value creation</strong> and <strong>cohesion</strong> within their organization. The outcome will be higher <strong>quality</strong>, <strong>customer delight</strong> and <strong>more revenue</strong>.</p> 
		
		<p>Learn about <a href="/resume/">my professional experience</a> since 1986.</p>
    <span style="clear:both; float:none"/>

	<p class="section">Professional Services</p>
	<p>I'm fluent in these languages:</p>
	<p align="center">
		<a href="/category/en.html"><img src="/img/language-flags/32x32/flag_rotate-02.png"></a>
		<a href="/category/de.html"><img src="/img/language-flags/32x32/flag_rotate-03.png"></a>
		<a href="/category/es.html"><img src="/img/language-flags/32x32/flag_rotate-12.png"></a>
	</p>
	<p align="center">
		<small>
			<a href="/category/en.html">English</a>
			<a href="/category/de.html">German</a>
			<a href="/category/es.html">Spanish</a>
		</small>
	</p>
	<div class="no-print-sidebar">
		<p>Scrum Pair-Coaching to develop technical competence:</p>
		<p align="center">Details in <a href="/en-pair-coaching-scrummaster.html">English</a>, <a
				href="/de-pair-coaching-scrummaster.html">Deutsch</a></p>

		<p><strong>Resources for new clients</strong>:</p>
		<p align="center"><a href="/resources/de-new-client.html">Deutsch</a></p>
	</div>

	<div class="no-print-sidebar">
		<p class="section noprint">Search</p>
		<form method="get" action="http://www.google.com/search">
			<p align="center"><input type="text" name="q" maxlength="255" value="" style="width: 180px" /></br>
				<input type="submit" value="Google Search" class="btn btn-primary btn-mini" />
			</p>
			<input type="hidden" name="sitesearch" value="http://www.stephan-schwab.com" />
		</form>

		<p class="section">Special&nbsp;Content</p>
		<ul class="special-content">
			<li><a href="/atdd/">Acceptance Test-Driven Development</a></li>
			<li><a href="/software-design/">Software Design</a></li>
			<li><a href="/sddm.html">Software Development Decision Making</a></li>
		</ul>
		<ul class="special-content">
			<li><a href="/coaching-future-masters.html">Coaching future masters</a></li>
		</ul>
		<ul class="special-content">
			<li><a href="/farmstead.html">Developing a farmstead in Andalucia, Spain</a></li>
			<li><a href="/house/">Building a house, Spain</a></li>
			<li><a href="/airtravel/">Business travel with light aircraft</a></li>
			<li><a href="/horses/">Horses</a></li>
			<li><a href="/panama-farm.html">Rainforest Farm, Panama</a></li>
			<li><a href="/galleries/">Photo Galleries</a></li>
		</ul>
		<ul class="special-content">
			<li><a href="/reading-list.html">My reading list</a></li>
		</ul>

		<p class="section">Highlights of the Year</p>
		<ul class="special-content">
			
			<li><a href="/2016/12/27/highlights-of-2016.html">2016</a></li>
			
			<li><a href="/2015/12/31/highlights-2015.html">2015</a></li>
			
			<li><a href="/2014/12/31/highlights-2014.html">2014</a></li>
			
			<li><a href="/2013/12/31/hightlights-2013.html">2013</a></li>
			
			<li><a href="/2012/12/31/highlights-2012.html">2012</a></li>
			
			<li><a href="/2011/12/31/highlights-2011.html">2011</a></li>
			
			<li><a href="/2010/12/31/highlights-2010.html">2010</a></li>
			
			<li><a href="/2009/12/31/highlights-2009.html">2009</a></li>
			
			<li><a href="/2008/12/31/highlights-2008.html">2008</a></li>
			
			<li><a href="/2007/12/31/highlights-2007.html">2007</a></li>
			
			<li><a href="/2006/12/31/highlights-2006.html">2006</a></li>
			
		</ul>

		<p class="section">Living on planet Earth</p>
		<ul class="special-content">
			<li><a href="/dominican-republic.html">Dominican Republic</a></li>
			<li><a href="/china.html">China</a></li>
			<li><a href="/germany.html">Germany</a></li>
			<li><a href="/panama.html">Panama</a></li>
			<li><a href="/spain.html">Spain</a></li>
			<li><a href="/usa.html">USA</a></li>
		</ul>

		<p class="section">Open Source Projects</p>
		<ul class="special-content">
			<li><a href="/ale-news.html">Development of ALE News</a></li>
			<li><a href="https://github.com/snscaimito/RAutomation">RAutomation</a></li>
			<li><a href="/open-source.html">Other contributions to Open Source</a></li>
		</ul>

		<p class="section">Stay in touch</p>
		<p align="center">
			<a href="/rss.xml"><img src="/img/Furry-Cushion-RSS_48.png" /></a>
			<a href="https://twitter.com/snscaimito"><img src="/img/Furry-Cushion-Twitter_48.png" /></a>
			<a href="http://www.linkedin.com/in/stephanschwab"><img src="/img/Furry-Cushion-LinkedIn_48.png" /></a>
		</p>
		<p align="center">
			<a rel="me" href="https://techhub.social/@snscaimito"><img src="/img/mastodon.svg" width="48" /></a>
			<a href="https://bsky.app/profile/snscaimito.bsky.social"><img src="/img/Bluesky_butterfly-logo.svg"
					width="65" /></a>
			<a href="https://www.tiktok.com/@snscaimito"><img src="/img/tiktok-icon-white-1-logo-svgrepo-com.svg"
					width="48" /></a>
		</p>
		<p align="center">
			<a href="mailto:sns@caimito.net?subject=From%20stephan-schwab.com">sns@caimito.net</a>
		</p>

		<p class=" section">My Books
		</p>
		<p align="center"><a href="https://leanpub.com/activitycentereddesign"><img
					src="/img/smarter-software-with-activity-centered-design.jpg" /></a></p>
		<p align="center"><a href="https://leanpub.com/essays-on-software-development-2012"><img
					src="/img/essays-on-software-development-2012.png" /></a></p>

		<p class="section">Everything</p>
		<p>See a listing of <a href="/all-posts.html">all posts</a> on this site.</p>
	</div>
</div>
			</div>
		</div>
	</div>
		<script src="//use.typekit.net/npx1yoc.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
	
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-35257032-1', 'auto');
	  ga('require', 'displayfeatures');
	  ga('send', 'pageview');

	</script>
	<script type="text/javascript"> 
		jQuery(document).ready(function(){ 
			jQuery("#gallery").unitegallery(); 
		}); 
	</script>
	
	<script>
		$(document).ready(function() {
			$('.social-blogging').each(function() {
				const service = $(this).attr('service');
				const url = `/api/posted-on/${service}?article=${window.location.pathname}`;

				fetch(url)
					.then(response => response.json())
					.then(data => {
						console.log(data)
						$(this).attr('href', data.postUrl)
					})
					.catch(error => console.error('Error:', error));
			})
		})
	</script>

</body>
</html>
