<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Acceptance Test Driven Development for Windows</title>
	
	<link rel="canonical" href="http://0.0.0.0:4000/2011/01/21/acceptance-test-driven-development-for-windows.html"/>
	
	<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/css/schwab.css" type="text/css" />
	<link rel="stylesheet" href="/css/print.css" media="print" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+Condensed|Sansita:700|Zilla+Slab" rel="stylesheet">
	
	<link rel="alternate" type="application/rss+xml" title="Stephan Schwab" href="/rss.xml"/>

	<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
	<script type='text/javascript' src='/unitegallery/js/unitegallery.min.js'></script> 
		
	<link rel='stylesheet' href='/unitegallery/css/unite-gallery.css' type='text/css' /> 
	<script type='text/javascript' src='/unitegallery/themes/tiles/ug-theme-tiles.js'></script> 

	<meta property="og:title" content="Acceptance Test Driven Development for Windows">
	<meta property="twitter:title" content="Acceptance Test Driven Development for Windows">
	<meta property="og:description" content="">
	<meta property="twitter:description" content="">
	<meta property="og:type" content="article">
	<meta property="og:url" content="http://0.0.0.0:4000/2011/01/21/acceptance-test-driven-development-for-windows.html">
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:site" content="@snscaimito">
	
</head>


<body>
	<div class="container">
		<div class="header no-print">
  <div class="menu">
    <a href="/">Home</a>
    <a href="/category/software_development.html">Software</a>
    <a href="/category/farm-life.html">Farm Life</a>
    <a href="/category/Business.html">Business</a>
    <a href="/category/aviation.html">Aviation</a>
  </div>
  <div class="claim-box">
    <p class="claim">Tales about Aviation, Coaching, Farming, Software Development</p>
  </div>
</div>
		<div class="row">
			<div class="span9">
				<div class="post">
					<h1>Acceptance Test Driven Development for Windows</h1>
          <p>Software Development driven by tests (TDD) is considered a very good practice to write quality code without technical defects. TDD works well for programmers. It helps to design and test the building blocks of any software system.</p>

<p>Still, despite all the efforts of programmers to write correct code, defects are found during QA testing. If that happens programmers have to go back and fix these things which will hurt the team’s velocity.</p>

<p>Another problem is that TDD alone does not ensure that the team is building the right solution. The requirements may miss important information and it is no surprise that these gaps are discovered once the customer sees the software in action for the first time.</p>

<p>Acceptance Test-Driven Development is a technique related to Behavior-Driven Development that can be very helpful in solving this problem. In this post I don’t want to elaborate deeper on what ATDD is. I have written about this <a href="/2010/10/17/cucumber-when-programmers-have-a-dream.html">myself lately</a> after I had great success with it on a client project and Cheezy also has a very good description of how <a href="http://www.cheezyworld.com/2010/12/26/a-day-of-acceptance-testing/">a day in the life of an acceptance tester</a> looks like.</p>

<p>Instead I want to talk about a tool that programmers and testers can use for doing ATDD to develop Windows desktop applications.</p>

<p>For web applications one can use <a href="http://seleniumhq.org/">Selenium</a> or <a href="http://watir.com/">Watir</a> to remotely control the browser so it types text, clicks on something or figures out what is displayed. Both come with a Ruby API that makes it easy to use them in <a href="http://cukes.info/">Cucumber</a> step definitions. Ruby is a simple enough language that testers without programming background can quickly learn and at the same time Ruby allows to program all kinds of other things. For a tester that makes learning Ruby far more interesting than to learn some vendor specific scripting language. Further there are many libraries for all kinds of things out there that allows the more advanced tester to handle test data, fake external systems and whatever you can imagine.</p>

<p>What has not been available so far was something that would allow testers to use <a href="http://cukes.info/">Cucumber</a> on Windows desktop applications.</p>

<p>In December 2010 Jarmo Pertman announced RAutomation in a <a href="http://www.itreallymatters.net/post/2352350743/automating-windows-and-their-controls-with-ruby">blog post</a> and on the <a href="http://www.mail-archive.com/watir-general@googlegroups.com/msg12259.html">Watir mailinglist</a>. RAutomation is a Ruby library that allows you to automate Windows desktop application using an API very close to Watir for web applications.</p>

<p>Around the same time a client was looking for a tool for the same purpose and I was doing some experiments to research the topic. I wrote a simple <a href="http://cukes.info/">Cucumber</a> feature to test Windows’ Notepad application. From my step definitions in Ruby I called some objects that in turn used the <a href="https://github.com/ffi/ffi">FFI</a> library to call Win32 C functions to retrieve information about Windows controls, send keystrokes or click on things.</p>

<p>After we learned about RAutomation it was decided to collaborate with Jarmo on his library and I forked RAutomation on GitHub. Since then I created a sample application in C# and extended RAutomation’s API to support checkboxes, radio buttons and comboboxes. There will be support for list views (tables) soon as well.</p>

<p>During that work I made an interesting discovery. My sample application in C# is using Windows Forms via the Windows Presentation Framework. Once I tried to send the BM_GETSTATE message to one of the checkboxes to learn whether it was ticked or not I got no response. The return code from SendMessage was always 0 which either means that the box is not ticked or there was an error. Great! So which one is it? Some research revealed that the buttons in my application were not regular buttons but instead controls drawn by the Windows Forms framework and because of that they do not respond to the usual Win32 messages.</p>

<p>So I ended up using Microsoft Active Accessibility which offers a COM interface that one can use to get to the state of a checkbox and other buttons.</p>

<p>Unfortunately using the IAccessible COM interface from Ruby was difficult. I am using Ruby <a href="https://github.com/ffi/ffi">FFI</a> to call the Windows API. <a href="https://github.com/ffi/ffi">FFI</a> allows me to build C structs and unions, work with function pointers etc. The challenge was that one of the IAccessible methods (get_accState) expects a VARIANT data type to be passed by value and it also wants a pointer to a VARIANT as its output parameter.</p>

<p>VARIANT is a very common data type used in many places of the Windows API. It is used to pass a number, a string, an interface pointer and many other things to functions or to receive those things. It is a C union that has simple members, structs and other unions inside. In C/C++ the compiler will make sure that the right amount of memory gets allocated but how to model this in Ruby using <a href="https://github.com/ffi/ffi">FFI</a>? I’m sure that <a href="https://github.com/ffi/ffi">FFI</a> can do it as there are FFI::Struct and FFI::Union but VARIANT is a huge thing and all you get is a segmentation fault, if you are just one byte off :-(</p>

<p>So in the end I wrote a DLL in C++ that exports a C function which I can call from Ruby via <a href="https://github.com/ffi/ffi">FFI</a>. That keeps the VARIANT stuff to the right language and from Ruby I only have to deal with simple data types that are easy to handle.</p>

<p>I’d like to thank Jarmo for the work he has done on RAutomation and hope that he will pull in my extensions after I cleaned up my fork a bit.</p>

<p>My fork is on GitHub at <a href="https://github.com/snscaimito/RAutomation">https://github.com/snscaimito/RAutomation</a></p>

					<table class="postfooter" style="width: 100%">
					<tr>
						<td style="text-align: left; width: 33%"><a href="/2010/12/31/highlights-2010.html">Previous</a></td>
						<td style="text-align: center; width: 33%">21 Jan 2011</td>
						<td style="text-align: right; width: 33%"><a href="/2011/02/18/telling-real-stories-in-acceptance-test-driven-development.html">Next</a></td>
					</tr>
					</table>
					<p>This article has been posted to social media sites. There might be comments. Just follow the links:</p>
					<div>
						<a class="social-blogging" service="twitter" href="https://twitter.com/snscaimito"><img src="/img/Furry-Cushion-Twitter_48.png" /></a>
						<a class="social-blogging" service="activityPub" rel="me" href="https://techhub.social/@snscaimito"><img src="/img/mastodon.svg" width="48" /></a>
					</div>
				</div>
			</div>
			<div class="span3">
        <div class="sidebar">
        	<p class="section">About this article</p>
          <p>Published: January 21, 2011</p>
					<p>Posted in:
						
							<a class="categoryLink" href="/category/software_development.html">software_development</a>
						
							<a class="categoryLink" href="/category/atdd.html">atdd</a>
						
					</p>
          
        </div>
				<div class="sidebar">
	<p class="section">About me</p>
	<p>Hello! My name is <a href="/">Stephan Schwab</a>.</p>
			<a href="/"><img src="http://www.gravatar.com/avatar/663d11426b0a187ddac59f8c17ce61b4?s=90" class="align-left"/></a>
		<p>As International Software Development Coach and Consultant I help CEOs and Department Leaders to <strong>improve</strong> <strong>value creation</strong> and <strong>cohesion</strong> within their organization. The outcome will be higher <strong>quality</strong>, <strong>customer delight</strong> and <strong>more revenue</strong>.</p> 
		
		<p>Learn about <a href="/resume/">my professional experience</a> since 1986.</p>
    <span style="clear:both; float:none"/>

	<p class="section">Professional Services</p>
	<p>I'm fluent in these languages:</p>
	<p align="center">
		<a href="/category/en.html"><img src="/img/language-flags/32x32/flag_rotate-02.png"></a>
		<a href="/category/de.html"><img src="/img/language-flags/32x32/flag_rotate-03.png"></a>
		<a href="/category/es.html"><img src="/img/language-flags/32x32/flag_rotate-12.png"></a>
	</p>
	<p align="center">
		<small>
			<a href="/category/en.html">English</a>
			<a href="/category/de.html">German</a>
			<a href="/category/es.html">Spanish</a>
		</small>
	</p>
	<div class="no-print-sidebar">
		<p>Scrum Pair-Coaching to develop technical competence:</p>
		<p align="center">Details in <a href="/en-pair-coaching-scrummaster.html">English</a>, <a
				href="/de-pair-coaching-scrummaster.html">Deutsch</a></p>

		<p><strong>Resources for new clients</strong>:</p>
		<p align="center"><a href="/resources/de-new-client.html">Deutsch</a></p>
	</div>

	<div class="no-print-sidebar">
		<p class="section noprint">Search</p>
		<form method="get" action="http://www.google.com/search">
			<p align="center"><input type="text" name="q" maxlength="255" value="" style="width: 180px" /></br>
				<input type="submit" value="Google Search" class="btn btn-primary btn-mini" />
			</p>
			<input type="hidden" name="sitesearch" value="http://www.stephan-schwab.com" />
		</form>

		<p class="section">Special&nbsp;Content</p>
		<ul class="special-content">
			<li><a href="/atdd/">Acceptance Test-Driven Development</a></li>
			<li><a href="/software-design/">Software Design</a></li>
			<li><a href="/sddm.html">Software Development Decision Making</a></li>
		</ul>
		<ul class="special-content">
			<li><a href="/coaching-future-masters.html">Coaching future masters</a></li>
		</ul>
		<ul class="special-content">
			<li><a href="/farmstead.html">Developing a farmstead in Andalucia, Spain</a></li>
			<li><a href="/house/">Building a house, Spain</a></li>
			<li><a href="/airtravel/">Business travel with light aircraft</a></li>
			<li><a href="/horses/">Horses</a></li>
			<li><a href="/panama-farm.html">Rainforest Farm, Panama</a></li>
			<li><a href="/galleries/">Photo Galleries</a></li>
		</ul>
		<ul class="special-content">
			<li><a href="/reading-list.html">My reading list</a></li>
		</ul>

		<p class="section">Highlights of the Year</p>
		<ul class="special-content">
			
			<li><a href="/2016/12/27/highlights-of-2016.html">2016</a></li>
			
			<li><a href="/2015/12/31/highlights-2015.html">2015</a></li>
			
			<li><a href="/2014/12/31/highlights-2014.html">2014</a></li>
			
			<li><a href="/2013/12/31/hightlights-2013.html">2013</a></li>
			
			<li><a href="/2012/12/31/highlights-2012.html">2012</a></li>
			
			<li><a href="/2011/12/31/highlights-2011.html">2011</a></li>
			
			<li><a href="/2010/12/31/highlights-2010.html">2010</a></li>
			
			<li><a href="/2009/12/31/highlights-2009.html">2009</a></li>
			
			<li><a href="/2008/12/31/highlights-2008.html">2008</a></li>
			
			<li><a href="/2007/12/31/highlights-2007.html">2007</a></li>
			
			<li><a href="/2006/12/31/highlights-2006.html">2006</a></li>
			
		</ul>

		<p class="section">Living on planet Earth</p>
		<ul class="special-content">
			<li><a href="/dominican-republic.html">Dominican Republic</a></li>
			<li><a href="/china.html">China</a></li>
			<li><a href="/germany.html">Germany</a></li>
			<li><a href="/panama.html">Panama</a></li>
			<li><a href="/spain.html">Spain</a></li>
			<li><a href="/usa.html">USA</a></li>
		</ul>

		<p class="section">Open Source Projects</p>
		<ul class="special-content">
			<li><a href="/ale-news.html">Development of ALE News</a></li>
			<li><a href="https://github.com/snscaimito/RAutomation">RAutomation</a></li>
			<li><a href="/open-source.html">Other contributions to Open Source</a></li>
		</ul>

		<p class="section">Stay in touch</p>
		<p align="center">
			<a href="/rss.xml"><img src="/img/Furry-Cushion-RSS_48.png" /></a>
			<a href="https://twitter.com/snscaimito"><img src="/img/Furry-Cushion-Twitter_48.png" /></a>
			<a href="http://www.linkedin.com/in/stephanschwab"><img src="/img/Furry-Cushion-LinkedIn_48.png" /></a>
		</p>
		<p align="center">
			<a rel="me" href="https://techhub.social/@snscaimito"><img src="/img/mastodon.svg" width="48" /></a>
			<a href="https://bsky.app/profile/snscaimito.bsky.social"><img src="/img/Bluesky_butterfly-logo.svg"
					width="65" /></a>
			<a href="https://www.tiktok.com/@snscaimito"><img src="/img/tiktok-icon-white-1-logo-svgrepo-com.svg"
					width="48" /></a>
		</p>
		<p align="center">
			<a href="mailto:sns@caimito.net?subject=From%20stephan-schwab.com">sns@caimito.net</a>
		</p>

		<p class=" section">My Books
		</p>
		<p align="center"><a href="https://leanpub.com/activitycentereddesign"><img
					src="/img/smarter-software-with-activity-centered-design.jpg" /></a></p>
		<p align="center"><a href="https://leanpub.com/essays-on-software-development-2012"><img
					src="/img/essays-on-software-development-2012.png" /></a></p>

		<p class="section">Everything</p>
		<p>See a listing of <a href="/all-posts.html">all posts</a> on this site.</p>
	</div>
</div>
			</div>
		</div>
	</div>
		<script src="//use.typekit.net/npx1yoc.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
	
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-35257032-1', 'auto');
	  ga('require', 'displayfeatures');
	  ga('send', 'pageview');

	</script>
	<script type="text/javascript"> 
		jQuery(document).ready(function(){ 
			jQuery("#gallery").unitegallery(); 
		}); 
	</script>
	
	<script>
		$(document).ready(function() {
			$('.social-blogging').each(function() {
				const service = $(this).attr('service');
				const url = `/api/posted-on/${service}?article=${window.location.pathname}`;

				fetch(url)
					.then(response => response.json())
					.then(data => {
						console.log(data)
						$(this).attr('href', data.postUrl)
					})
					.catch(error => console.error('Error:', error));
			})
		})
	</script>

</body>
</html>
